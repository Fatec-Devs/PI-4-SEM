generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model access_logs {
  id          String    @id @default(uuid()) @db.Uuid
  user_id     String?   @db.Uuid
  app_user_id String?   @db.Uuid
  action      String    @db.Text
  resource    String    @db.Text
  resource_id String?   @db.Text
  details     String?   @db.Text
  ip_address  String?   @db.Text
  user_agent  String?   @db.Text
  created_at  DateTime? @default(now()) @db.Timestamp(6)
}

model app_password_history {
  id             String    @id @default(uuid()) @db.Uuid
  app_user_id    String    @db.Uuid
  password_hash  String    @db.Text
  changed_at     DateTime? @default(now()) @db.Timestamp(6)
  changed_by     String?   @db.Uuid

  @@index([app_user_id])
}

model application_users {
  id                   String    @id @default(uuid()) @db.Uuid
  username             String    @db.Text
  matricula            String    @db.Text
  password_hash        String    @db.Text
  password_expires_at  DateTime? @db.Timestamp(6)
  is_active            Boolean?  @default(true)
  created_at           DateTime? @default(now()) @db.Timestamp(6)
  updated_at           DateTime? @default(now()) @db.Timestamp(6)
  last_login_at        DateTime? @db.Timestamp(6)
  created_by           String?   @db.Uuid
  team_id              String?   @db.Uuid

  @@unique([username])
  @@unique([matricula])
  @@index([team_id])
}

model password_history {
  id             String    @id @default(uuid()) @db.Uuid
  user_id        String    @db.Uuid
  password_hash  String    @db.Text
  changed_at     DateTime? @default(now()) @db.Timestamp(6)
  changed_by     String?   @db.Uuid

  @@index([user_id])
}

model system_permissions {
  id          String @id @default(uuid()) @db.Uuid
  name        String @db.Text
  description String @db.Text
  resource    String @db.Text
  action      String @db.Text
  created_at  DateTime? @default(now()) @db.Timestamp(6)

  @@unique([resource, action])
}

model teams {
  id          String    @id @default(uuid()) @db.Uuid
  name        String    @db.Text
  description String?   @db.Text
  is_active   Boolean?  @default(true)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @db.Timestamp(6)
}

model user_teams {
  id      String @id @default(uuid()) @db.Uuid
  user_id String @db.Uuid
  team_id String @db.Uuid
  role    String @default("member") @db.Text
  joined_at DateTime? @default(now()) @db.Timestamp(6)

  @@unique([user_id, team_id])
  @@index([team_id])
}

model users {
  id                String    @id @default(uuid()) @db.Uuid
  username          String    @db.Text
  email             String?   @db.Text
  password_hash     String    @db.Text
  full_name         String?   @db.Text
  matricula         String?   @db.Text
  is_active         Boolean?  @default(true)
  created_at        DateTime? @default(now()) @db.Timestamp(6)
  updated_at        DateTime? @default(now()) @db.Timestamp(6)
  last_login_at     DateTime? @db.Timestamp(6)
  password_expires_at DateTime? @db.Timestamp(6)

  @@unique([username])
}